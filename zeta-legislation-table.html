<html>

  <link href="https://cdn.datatables.net/v/dt/dt-1.13.7/datatables.min.css" rel="stylesheet">
      
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.9/jquery.csv.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
      
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Inter:300,regular,500,600,700,800","Poppins:200,200italic,300,300italic,regular,italic,500,500italic,600,700,800,900","Roboto:300,regular,italic,700"]  }});</script>
      
  <style>
    .dataTables_wrapper {
      font-family: Roboto, sans-serif;
      font-size: 12px;
    }

    table {
      font-family: Roboto, sans-serif;
      font-size: 12px;
    }
  </style>

  <h1 style="font-family: Roboto, sans-serif;">ZETA Legislation Tracker</h1>
  <table class="display compact"></table>
      
  <script>        
    (function() {
      "use strict";

      $(document).ready(function() {
        var columns = [];

        $.ajax({
          type: "GET",
          url: "https://sheets.googleapis.com/v4/spreadsheets/1sS95nWK7dy3O0fo1Th8ppVh9xKzMJGu18Baz_MHqQG8/values/legislation-tracker?alt=json&key=AIzaSyDsgn_PB4cvwhO0ldCsBBsr-E8xYEpi77Y",
          success: function(data) {
            var columnNames = data.values[0];
            for (var i in columnNames) {
              columns.push({
                title: columnNames[i]
              });
            }

            var tableData = data.values.slice();
            tableData.shift();
            $("table").DataTable({
              order: [],
              data: tableData,
              columns: columns,
              initComplete: function () {
                this.api()
                  .columns()
                  .every(function () {
                    // Make ctrl+a works 
                    $('.sorting').keydown(function(e){
                      if (e.keyCode == 65 && e.ctrlKey) {
                        e.target.select()
                      }
                    })

                    let column = this;
                    let title = column.header().textContent;

                    // Create br, input elements
                    let hr = document.createElement('br');
                    let input = document.createElement('input');
                    input.placeholder = title;
                    
                    // Stop parent sort event in search column
                    input.onclick = function(e) {
                      e.stopPropagation();
                    }
                    
                    // Append hr, input elements to header column
                    column.header().appendChild(hr);
                    column.header().appendChild(input);

                    // Event listener for user input
                    input.addEventListener('keyup', () => {
                      if (column.search() !== this.value) {
                        column.search(input.value).draw();
                      }
                    });
                  });
              }
            })
          }
        });
      });
    })();
  </script>
</html>
